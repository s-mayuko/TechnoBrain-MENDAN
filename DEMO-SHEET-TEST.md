# デモシートテスト実行手順

最終更新: 2026-01-28

## 🎯 目的

`SetupDemoSheet.gs` を実際に実行して、100項目のデモシートが正しく作成されるか確認します。

---

## ✅ 事前準備

### 必要なもの
- [ ] Googleアカウント
- [ ] インターネット接続
- [ ] ブラウザ（Chrome推奨）

### 確認事項
- [ ] `apps_script/SetupDemoSheet.gs` ファイルが存在する
- [ ] ファイルの内容を確認済み（typo修正済み）

---

## 🚀 テスト実行手順

### Step 1: 新しいスプレッドシートを作成

1. **Google Sheets を開く**
   - URL: https://sheets.google.com/

2. **新規作成**
   - 「空白」または「＋」をクリック
   - 新しいスプレッドシートが開く

3. **タイトル変更**
   - 左上の「無題のスプレッドシート」をクリック
   - 「MENDAN デモシート - テスト」と入力

---

### Step 2: Apps Script エディタを開く

1. **メニューから開く**
   - 「拡張機能」→「Apps Script」をクリック
   - 新しいタブでApps Scriptエディタが開く

2. **既存コードを削除**
   - デフォルトの `function myFunction() { ... }` を全て削除

---

### Step 3: スクリプトをコピー＆ペースト

1. **SetupDemoSheet.gs を開く**
   - エクスプローラーで `apps_script/SetupDemoSheet.gs` を開く
   - 全文をコピー（Ctrl+A → Ctrl+C）

2. **Apps Script に貼り付け**
   - Apps Scriptエディタに貼り付け（Ctrl+V）
   - 左上のファイル名を「SetupDemoSheet」に変更（任意）

3. **保存**
   - 「💾 プロジェクトを保存」をクリック（または Ctrl+S）
   - プロジェクト名を入力（例: `MENDANデモシート初期化`）

---

### Step 4: スクリプトを実行

#### 方法A: 関数を直接実行（推奨）

1. **関数を選択**
   - 上部の関数ドロップダウンから `setupDemoSheet` を選択

2. **実行**
   - 「▶ 実行」ボタンをクリック

3. **初回実行時の権限承認**
   - 「権限の確認」ダイアログが表示される
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「このアプリは確認されていません」→ 「詳細」をクリック
   - 「（安全ではないページに移動）」をクリック
   - 「許可」をクリック

4. **実行結果確認**
   - 実行ログに以下が表示される:
     ```
     📋 デモシートのセットアップを開始します...
     ✅ ヘッダー設定完了
     ✅ 項目名入力完了（100項目）
     ✅ チェックボックス設定完了
     ✅ 初期値設定完了（Portersにチェック）
     ✅ 条件付き書式設定完了（6ルール）
     ✅ 列幅調整完了
     ✅ セットアップ完了！
     ```

5. **アラート確認**
   - スプレッドシートに戻ると「デモシートのセットアップが完了しました！」とアラート表示

---

### Step 5: 結果確認

#### 5-1. シート確認

1. **スプレッドシートに戻る**
   - `merge_ui` シートが作成されている

2. **ヘッダー確認**
   - 1行目が青色背景、白文字
   - 列: A（項目名）、B（Porters採用）、C（Porters値）... O（送信ID）

3. **項目名確認（A列）**
   - 2行目: 氏名
   - 3行目: 生年月日(年齢)
   - 4行目: 婚姻
   - ...
   - 101行目: メールアドレス
   - **合計: 100項目**

4. **チェックボックス確認（B/D/F列）**
   - B列（Porters採用）: すべてチェックON（✓）
   - D列（音声採用）: すべてチェックOFF
   - F列（手入力採用）: すべてチェックOFF

5. **採用ソース確認（H列）**
   - 全て「porters」

6. **ウィンドウ固定確認**
   - スクロールしても1行目（ヘッダー）が固定
   - スクロールしてもA列（項目名）が固定

---

#### 5-2. 条件付き書式確認

1. **B列・C列の色確認**
   - B列にチェックが入っているため、B列・C列が**薄い緑色**（#D9EAD3）

2. **H列の色確認**
   - 「porters」が入っているため、H列が**緑色**（#B6D7A8）

3. **チェックの切り替えテスト**
   - 任意の行（例: 2行目）でB列のチェックを外す
   - → B列・C列の緑色が消える
   - D列にチェックを入れる
   - → D列・E列が**黄色**に変わる
   - F列にチェックを入れる
   - → F列・G列が**青色**に変わる

4. **H列の値変更テスト**
   - H列の値を「audio」に変更
   - → H列が**黄色**に変わる
   - H列の値を「manual」に変更
   - → H列が**青色**に変わる

---

### Step 6: サンプルデータ追加（任意）

1. **カスタムメニュー確認**
   - スプレッドシートを再読み込み（F5）
   - メニューバーに「デモシート設定」が表示される

2. **サンプルデータ追加**
   - 「デモシート設定」→「📝 サンプルデータ追加」をクリック

3. **結果確認**
   - C列（Porters値）に値が入る:
     - 氏名: 山田太郎
     - 生年月日: 1990/01/01
     - 電話番号: 090-1234-5678
     - 年収: 500万円
   
   - E列（音声抽出値）に値が入る:
     - 氏名: 山田太郎
     - 生年月日: 1990/03/03
     - 電話番号: 090-1234-5678
   
   - J列（confidence）に値が入る:
     - high, medium等
   
   - K列（evidence）に値が入る:
     - transcript: "..."

---

## ✅ 成功基準

以下をすべて満たせば成功です：

### 必須項目
- [x] `merge_ui` シートが作成された
- [x] ヘッダー（1行目）が青色背景で15列ある
- [x] A列に100項目が入力されている
- [x] B/D/F列にチェックボックスがある
- [x] B列がすべてチェックON
- [x] H列に「porters」が入っている
- [x] ウィンドウ固定（1行目・A列）

### 条件付き書式
- [x] B列チェックON → B・C列が薄い緑色
- [x] D列チェックON → D・E列が黄色
- [x] F列チェックON → F・G列が青色
- [x] H列「porters」→ 緑色
- [x] H列「audio」→ 黄色
- [x] H列「manual」→ 青色

### 機能確認
- [x] カスタムメニュー「デモシート設定」が表示される
- [x] サンプルデータが追加できる

---

## 🐛 トラブルシューティング

### エラー: 「ReferenceError: setupDemoSheet is not defined」

**原因:** スクリプトが保存されていない、または関数名が間違っている

**解決策:**
1. Apps Scriptで「💾 プロジェクトを保存」
2. 関数ドロップダウンから `setupDemoSheet` を選択し直す
3. 再実行

---

### エラー: 「Exception: 既存のシートを削除できません」

**原因:** `merge_ui` シートが唯一のシートで削除できない

**解決策:**
1. スプレッドシートに別のシート（Sheet1等）を追加
2. `setupDemoSheet` を再実行

---

### エラー: 「TypeError: Cannot read property 'setBackground' of null」

**原因:** 条件付き書式のメソッド名にtypo（修正済み）

**解決策:**
1. 最新の `SetupDemoSheet.gs` を使用（typo修正済み）
2. `.whenFormulaCatisfied` → `.whenFormulaSatisfied`

---

### 条件付き書式が適用されない

**原因:** 範囲が正しく設定されていない

**解決策:**
1. `setupDemoSheet` を再実行
2. または、手動で設定:
   - 「表示形式」→「条件付き書式」
   - ルールを確認・再設定

---

### カスタムメニューが表示されない

**原因:** ページが再読み込みされていない

**解決策:**
1. スプレッドシートを再読み込み（F5）
2. または、Apps Scriptで `onOpen` を手動実行

---

## 📊 テスト結果レポート（記入用）

### 実行環境
- **実行日時:** _______________
- **実行者:** _______________
- **ブラウザ:** Chrome / Safari / Edge / その他 _______________

### 実行結果
- [ ] Step 1-4: スクリプト実行成功
- [ ] Step 5-1: シート確認OK
- [ ] Step 5-2: 条件付き書式確認OK
- [ ] Step 6: サンプルデータ追加成功

### 問題点
_______________________________________________
_______________________________________________
_______________________________________________

### 所感
_______________________________________________
_______________________________________________
_______________________________________________

---

## 📸 スクリーンショット（推奨）

テスト完了後、以下のスクリーンショットを撮影してください：

1. **全体ビュー**
   - merge_uiシート全体
   - ヘッダー、A列、条件付き書式が見えるように

2. **条件付き書式テスト**
   - チェックを切り替えた状態
   - 色の変化が確認できるように

3. **サンプルデータ**
   - サンプルデータ追加後の状態

---

## 🎯 次のステップ

テストが成功したら：

1. ✅ お客様デモ用のスプレッドシートを本番作成
2. ✅ 既存の `Code.gs` と統合
3. ✅ 実際のデータで動作確認
4. ✅ お客様にデモ

---

**テストを実行してください！問題があればすぐに報告してください。** 🚀
