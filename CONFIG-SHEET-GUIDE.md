# configシート設定ガイド

## 概要

`config` シートを使用すると、コード修正なしでフィールドのマッピングやバリデーションルールを管理できます。

## シート構造

### 1. configシートの作成

1. スプレッドシートに新しいシートを作成
2. シート名を `config` に変更
3. 以下のヘッダーを設定（1行目）：

| A | B | C | D | E |
|---|---|---|---|---|
| label | key | type | required | validation |

### 2. 列の説明

| 列 | 説明 | 例 |
|---|---|---|
| **A: label** | 項目名（merge_uiシートのA列と一致させる） | `氏名`, `生年月日`, `希望年収` |
| **B: key** | Webhook送信時のフィールドキー | `name`, `birth_date`, `desired_salary` |
| **C: type** | データ型 | `string`, `int`, `date`, `email` |
| **D: required** | 必須項目フラグ（TRUE/FALSE） | `TRUE`, `FALSE` |
| **E: validation** | 正規表現パターン（任意） | `^\d{3}-\d{4}-\d{4}$` |

### 3. サンプル設定

| label | key | type | required | validation |
|-------|-----|------|----------|------------|
| 氏名 | name | string | TRUE | |
| 生年月日 | birth_date | date | TRUE | |
| 電話番号 | phone | string | FALSE | `^0\d{1,4}-\d{1,4}-\d{4}$` |
| メールアドレス | email | email | TRUE | |
| 希望年収 | desired_salary | int | FALSE | |
| 郵便番号 | postal_code | string | FALSE | `^\d{3}-\d{4}$` |

## データ型（type列）

| 型 | 説明 | バリデーション |
|---|---|---|
| `string` | 文字列 | なし |
| `int` / `integer` | 整数 | 数値チェック（カンマ区切り可） |
| `number` / `float` | 数値（小数可） | 数値チェック |
| `date` | 日付 | YYYY/MM/DD, YYYY-MM-DD形式 |
| `email` | メールアドレス | メール形式チェック |

## バリデーションルール

### 必須項目（required列）

- `TRUE`: 必須項目。値が空の場合はエラー
- `FALSE` または空欄: 任意項目

### 正規表現パターン（validation列）

カスタムバリデーションを設定できます。

#### 例1: 電話番号（ハイフンあり）

```
^\d{2,4}-\d{2,4}-\d{4}$
```

- `090-1234-5678` ✅
- `03-1234-5678` ✅
- `09012345678` ❌

#### 例2: 郵便番号

```
^\d{3}-\d{4}$
```

- `123-4567` ✅
- `1234567` ❌

#### 例3: 数値範囲（年収）

```
^[1-9]\d{2,3}万円$
```

- `500万円` ✅
- `1000万円` ✅
- `50万円` ❌（3桁以上）

## 使用例

### ケース1: 氏名（必須、文字列）

| label | key | type | required | validation |
|-------|-----|------|----------|------------|
| 氏名 | name | string | TRUE | |

→ 空欄の場合: `❌ 氏名: 必須項目です`

### ケース2: 年齢（任意、整数）

| label | key | type | required | validation |
|-------|-----|------|----------|------------|
| 年齢 | age | int | FALSE | |

→ 「abc」の場合: `❌ 年齢: 整数を入力してください（現在値: abc）`

### ケース3: 電話番号（必須、正規表現）

| label | key | type | required | validation |
|-------|-----|------|----------|------------|
| 電話番号 | phone | string | TRUE | `^0\d{1,4}-\d{1,4}-\d{4}$` |

→ 空欄の場合: `❌ 電話番号: 必須項目です`  
→ `12345678` の場合: `❌ 電話番号: 形式が正しくありません（パターン: ^0\d{1,4}-\d{1,4}-\d{4}$）`

## バリデーションエラーの表示

送信時にバリデーションエラーがある場合、以下のようなダイアログが表示されます：

```
バリデーションエラー:

❌ 氏名: 必須項目です
❌ 年齢: 整数を入力してください（現在値: abc）
❌ 電話番号: 形式が正しくありません（パターン: ^0\d{1,4}-\d{1,4}-\d{4}$）
```

## configシートなしでの動作

configシートが存在しない場合、最低限のバリデーション（値が空でないか）のみ実行されます。

## トラブルシューティング

### Q: configシートを作ったがバリデーションが動かない

A: 以下を確認:
1. シート名が正確に `config` か
2. ヘッダー行（1行目）が正しいか
3. label列の値がmerge_uiシートのA列と一致しているか

### Q: 正規表現が動作しない

A: 正規表現の構文を確認:
- エスケープが必要な文字: `\.` `\+` `\*` など
- テストツール: https://regex101.com/ で検証

### Q: required=TRUEなのにエラーが出ない

A: D列の値がセルの書式設定で「チェックボックス」になっている場合があります。テキスト `TRUE` と入力してください。

## 参考

- 正規表現リファレンス: https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Regular_Expressions
- データ型の詳細: `apps_script/Code.gs` の `validateFields()` 関数
