# デモ用スプレッドシート セットアップガイド

最終更新: 2026-01-28

## 📋 目次

1. [概要](#概要)
2. [セットアップ手順](#セットアップ手順)
3. [機能説明](#機能説明)
4. [使い方](#使い方)
5. [トラブルシューティング](#トラブルシューティング)

---

## 📖 概要

お客様デモ用に、100項目以上の詳細な職務経歴情報を持つスプレッドシートを自動生成します。

### 主な機能

- ✅ **100項目の自動入力**（氏名、学歴、職歴、スキル等）
- ✅ **条件付き書式**（チェック状態・採用ソースに応じて色分け）
- ✅ **初期値設定**（Portersにチェック）
- ✅ **ウィンドウ固定**（1行目・A列）
- ✅ **サンプルデータ追加**（テスト用）

---

## 🚀 セットアップ手順

### Step 1: 新しいスプレッドシートを作成

1. Google Sheets: https://sheets.google.com/
2. 「新しいスプレッドシート」を作成
3. タイトルを変更（例: `MENDAN デモシート`）

---

### Step 2: Apps Script エディタを開く

1. 「拡張機能」→「Apps Script」をクリック
2. Apps Script エディタが開く

---

### Step 3: スクリプトをコピー＆ペースト

1. `SetupDemoSheet.gs` の内容を全てコピー
   - ファイルパス: `apps_script/SetupDemoSheet.gs`
2. Apps Script エディタに貼り付け
   - 既存の `myFunction()` は削除してOK
3. 「💾 プロジェクトを保存」（Ctrl+S）

---

### Step 4: スクリプトを実行

#### 方法A: 関数を直接実行

1. 関数ドロップダウンから `setupDemoSheet` を選択
2. 「▶ 実行」をクリック
3. 初回実行時: 権限の承認が必要
   - 「権限を確認」→ Googleアカウント選択 → 「詳細」→ 「（安全ではないページに移動）」→ 「許可」
4. 実行完了後: 「デモシートのセットアップが完了しました！」とアラート表示

#### 方法B: カスタムメニューから実行

1. スプレッドシートに戻る（Apps Scriptを閉じる）
2. ページを再読み込み（F5）
3. メニューバーに「デモシート設定」が追加される
4. 「デモシート設定」→「🔧 デモシート初期化」をクリック

---

### Step 5: 結果確認

`merge_ui` シートが作成され、以下が設定されます：

| 項目 | 内容 |
|-----|------|
| **A列** | 100項目のラベル（氏名、生年月日、学歴、職歴等） |
| **B/D/F列** | チェックボックス |
| **H列** | 採用ソース（初期値: `porters`） |
| **条件付き書式** | チェック状態・採用ソースに応じて色分け |
| **ウィンドウ固定** | 1行目・A列が固定 |

---

## 🎨 機能説明

### 条件付き書式ルール

#### ルール1: Porters採用時（B列=TRUE）

- **対象**: B列・C列
- **色**: 薄い緑（#D9EAD3）

```
┌─────┬────────┬──────────┐
│項目 │Porters │Porters値 │
│     │採用    │          │
├─────┼────────┼──────────┤
│氏名 │   ☑    │山田太郎  │ ← 薄い緑
└─────┴────────┴──────────┘
```

---

#### ルール2: 音声採用時（D列=TRUE）

- **対象**: D列・E列
- **色**: 薄い黄色（#FFF2CC）

```
┌─────┬────────┬──────────┐
│項目 │音声    │音声抽出値│
│     │採用    │          │
├─────┼────────┼──────────┤
│氏名 │   ☑    │山田太郎  │ ← 薄い黄色
└─────┴────────┴──────────┘
```

---

#### ルール3: 手入力採用時（F列=TRUE）

- **対象**: F列・G列
- **色**: 薄い青（#CFE2F3）

```
┌─────┬────────┬──────────┐
│項目 │手入力  │手入力値  │
│     │採用    │          │
├─────┼────────┼──────────┤
│氏名 │   ☑    │山田太郎  │ ← 薄い青
└─────┴────────┴──────────┘
```

---

#### ルール4: 採用ソースによる色分け（H列）

| 値 | 色 | 16進数 |
|----|---|-------|
| `porters` | 緑色 | #B6D7A8 |
| `audio` | 黄色 | #FFE599 |
| `manual` | 青色 | #9FC5E8 |

```
┌──────────┐
│採用ソース│
├──────────┤
│ porters  │ ← 緑色
│ audio    │ ← 黄色
│ manual   │ ← 青色
└──────────┘
```

---

### 初期設定

| 列 | 初期値 | 説明 |
|----|-------|------|
| **B列** | `TRUE` | Portersにチェック |
| **D列** | `FALSE` | 音声はチェックなし |
| **F列** | `FALSE` | 手入力はチェックなし |
| **H列** | `porters` | 採用ソースはPorters |
| **C列・E列** | 保護 | 手動編集時に警告表示 |

---

### 排他制御（NEW）

#### 行レベル排他

B列・D列・F列は**同一行で1つのみ**チェック可能です。

**動作:**
1. B列にチェック → D列・F列が自動でOFF
2. D列にチェック → B列・F列が自動でOFF
3. F列にチェック → B列・D列が自動でOFF

**H列の自動更新:**
- チェックを変更すると、H列（採用ソース）が即座に更新されます
- B列チェック → H列が「porters」
- D列チェック → H列が「audio」
- F列チェック → H列が「manual」

---

### セル保護（NEW）

#### 保護対象

| 列 | 保護内容 | 理由 |
|----|---------|------|
| **C列** | Porters値 | 自動入力専用（手動編集防止） |
| **E列** | 音声抽出値 | 自動入力専用（手動編集防止） |

#### 保護レベル

**1. 警告モード（デフォルト）**
- 編集しようとすると警告が表示される
- 警告を無視すれば編集可能

**2. 完全ロック**
- 手動編集が完全に不可
- スクリプトからの編集のみ可能
- 設定方法: 「デモシート設定」→「🔒 セル保護」→「完全ロック（C・E列）」

#### 保護の解除

```
「デモシート設定」→「🔒 セル保護」→「保護解除」
```

---

## 📝 使い方

### 基本操作

#### 1. データソースの切り替え

1. B/D/F列のチェックを変更
   - ☑ Porters採用 → B・C列が緑色、H列が「porters」
   - ☑ 音声採用 → D・E列が黄色、H列が「audio」
   - ☑ 手入力採用 → F・G列が青色、H列が「manual」

2. 排他制御が自動で動作
   - 1つにチェックを入れると他が自動でOFF
   - H列（採用ソース）が即座に更新

**例:**
```
初期状態: B列にチェック
↓
D列にチェックを入れる
↓
結果: B列が自動でOFF、D列がON、H列が「audio」に変更
```

---

#### 2. サンプルデータの追加

1. 「デモシート設定」→「📝 サンプルデータ追加」
2. 以下のサンプルが追加されます:

| 項目 | Porters値 | 音声抽出値 | 手入力値 | 採用ソース |
|-----|----------|-----------|---------|----------|
| 氏名 | 山田太郎 | 山田太郎 | - | porters |
| 生年月日 | 1990/01/01 | 1990/03/03 | - | porters |
| 電話番号 | 090-1234-5678 | 090-1234-5678 | - | porters |
| 年収 | 500万円 | - | 600万円 | manual |

---

#### 3. 既存のCode.gsとの連携

`SetupDemoSheet.gs` は初期化専用です。

既存の `Code.gs` の機能（マージ・Webhook送信）と併用する場合：

1. **両方のスクリプトファイルを配置**
   - `Code.gs` - マージ・送信ロジック
   - `SetupDemoSheet.gs` - 初期化ロジック

2. **onOpen() の統合**

```javascript
// Code.gs と SetupDemoSheet.gs の onOpen() を統合
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  
  // デモシート設定メニュー
  ui.createMenu('デモシート設定')
    .addItem('🔧 デモシート初期化', 'setupDemoSheet')
    .addItem('📝 サンプルデータ追加', 'addSampleData')
    .addToUi();
  
  // データ統合メニュー（既存）
  ui.createMenu('データ統合')
    .addItem('マージしてWebhook送信', 'mergeAndSend')
    .addItem('Porters取得 → C列反映', 'importPorters')
    .addItem('音声処理 → E列反映', 'processAudio')
    .addToUi();
}
```

---

## 🔧 トラブルシューティング

### エラー: 「merge_uiシートが既に存在します」

**原因:** 既存のシートと競合

**解決策:**
1. 手動で `merge_ui` シートを削除
2. または、`setupDemoSheet()` を再実行（自動で削除して再作成）

---

### エラー: 「権限が必要です」

**原因:** 初回実行時の権限承認が必要

**解決策:**
1. 「権限を確認」をクリック
2. Googleアカウントでログイン
3. 「詳細」→「（安全ではないページに移動）」
4. 「許可」をクリック

---

### 条件付き書式が適用されない

**原因:** 範囲が不足している

**解決策:**
1. `setupDemoSheet()` を再実行
2. または、手動で条件付き書式を設定:
   - 「表示形式」→「条件付き書式」
   - 範囲: `B2:C` （全行）
   - 条件: `=$B2=TRUE`
   - 書式: 薄い緑

---

### メニューが表示されない

**原因:** ページが再読み込みされていない

**解決策:**
1. スプレッドシートを再読み込み（F5）
2. または、Apps Scriptで `onOpen()` を手動実行

---

## 📊 100項目の内訳

### 基本情報（11項目）
- 氏名、生年月日(年齢)、婚姻、住所、自宅種別、配偶者、扶養人数、子供、配偶者扶養、電話番号、メールアドレス

### 所属・実績（3項目）
- 所属学会、著書論文、海外生活/出張

### 現職情報（12項目）
- 現在年収、月給、残業、手当、賞与、賞与回数、月平均残業時間、現在の就業状況、雇用形態等

### 希望条件（13項目）
- 希望会社名、雇用形態、業種、職種、年収、職位、転職時期、勤務地、転勤、やりたい仕事等

### 職務経歴（30項目）
- 直近職歴、前職歴、前々職歴（会社名、業種、入社/退社、雇用形態、仕事内容等）

### スキル・資格（17項目）
- 主経験（言語、OS、DB等）、保有資格、英語レベル、TOEFL/TOEIC等

### 学歴（14項目）
- 最終学歴、学歴①②③、入学/卒業年月日、修了種類、海外学位、学歴備考

---

## 📚 関連ドキュメント

- [apps_script/Code.gs](./apps_script/Code.gs) - マージ・送信ロジック
- [POC-QUICKSTART.md](./POC-QUICKSTART.md) - 基本セットアップ
- [CONFIG-SHEET-GUIDE.md](./CONFIG-SHEET-GUIDE.md) - configシート設定

---

## 🎯 次のステップ

1. ✅ `setupDemoSheet()` でシート作成
2. ✅ `addSampleData()` でテストデータ追加
3. ✅ チェックボックスを切り替えて色の変化を確認
4. ✅ 既存の `Code.gs` と連携してマージ・送信テスト

---

**デモ準備完了です！お客様に見せる準備が整いました！** 🎉
